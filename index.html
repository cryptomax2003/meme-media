<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEME MEDIA | The Future of Meme Finance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        // ==========================================
        // FIREBASE CONFIGURATION
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDJUuShTLtA7vo2P67KX425ySL1lJ4Q_lo",
            authDomain: "mememedia-832af.firebaseapp.com",
            projectId: "mememedia-832af",
            storageBucket: "mememedia-832af.firebasestorage.app",
            messagingSenderId: "1014463566582",
            appId: "1:1014463566582:web:65e563f4f0f787626852d7"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        window.app = {
            data: {
                currentUser: null,
                users: [],
                posts: [],
                currentTab: 'all',
                currentCategory: 'All',
                searchQuery: '',
                authMode: 'login',
                verificationCode: null,
                codeExpiry: null,
                view: 'home',
                profileViewUser: null,
                codeDisplayTimeout: null,
                expandedComments: new Set(),
                unsubscribePosts: null,
                unsubscribeUsers: null
            },

            admins: ['cryptomax172003@gmail.com'],

            async init() {
                console.log('App initializing...');
                this.setupEventListeners();
                await this.checkAuth();
                this.render();
                console.log('App initialized successfully');
            },

            // ==========================================
            // REAL-TIME DATA SYNC WITH FIREBASE
            // ==========================================
            
            setupRealtimeListeners() {
                // Real-time posts listener
                this.data.unsubscribePosts = db.collection('posts')
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        this.data.posts = [];
                        snapshot.forEach((doc) => {
                            this.data.posts.push({ id: doc.id, ...doc.data() });
                        });
                        console.log('Posts updated:', this.data.posts.length);
                        this.renderPosts();
                    }, (error) => {
                        console.error('Posts listener error:', error);
                    });

                // Real-time users listener
                this.data.unsubscribeUsers = db.collection('users')
                    .onSnapshot((snapshot) => {
                        this.data.users = [];
                        snapshot.forEach((doc) => {
                            this.data.users.push({ email: doc.id, ...doc.data() });
                        });
                        console.log('Users updated:', this.data.users.length);
                        if (this.data.view === 'profile') {
                            this.renderProfile(this.data.profileViewUser);
                        }
                    }, (error) => {
                        console.error('Users listener error:', error);
                    });
            },

            stopRealtimeListeners() {
                if (this.data.unsubscribePosts) {
                    this.data.unsubscribePosts();
                }
                if (this.data.unsubscribeUsers) {
                    this.data.unsubscribeUsers();
                }
            },

            // ==========================================
            // AUTHENTICATION
            // ==========================================
            
            async checkAuth() {
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // Get user data from Firestore
                        const userDoc = await db.collection('users').doc(user.email).get();
                        if (userDoc.exists) {
                            this.data.currentUser = { email: user.email, ...userDoc.data() };
                            this.setupRealtimeListeners();
                        }
                    } else {
                        this.data.currentUser = null;
                        this.stopRealtimeListeners();
                        this.data.posts = [];
                        this.data.users = [];
                    }
                    this.updateAuthUI();
                    this.renderPosts();
                });
            },

            // ==========================================
            // NAVIGATION
            // ==========================================
            
            navigate(viewName, param = null) {
                console.log('Navigating to:', viewName);
                this.data.view = viewName;
                
                const views = ['homeView', 'createPostView', 'profileView', 'searchUserView', 'followersView'];
                views.forEach(v => {
                    const el = document.getElementById(v);
                    if (el) el.classList.add('hidden');
                });

                const viewMap = {
                    'home': 'homeView',
                    'create': 'createPostView',
                    'profile': 'profileView',
                    'search': 'searchUserView',
                    'followers': 'followersView'
                };

                const targetView = document.getElementById(viewMap[viewName]);
                if (targetView) {
                    targetView.classList.remove('hidden');
                }

                if (viewName === 'home') {
                    this.renderPosts();
                } else if (viewName === 'create') {
                    this.setupCreatePost();
                } else if (viewName === 'profile') {
                    this.renderProfile(param);
                } else if (viewName === 'followers') {
                    this.renderFollowersList(param);
                }
                
                window.scrollTo(0, 0);
            },

            setupCreatePost() {
                const postTypeSection = document.getElementById('postTypeSection');
                if (postTypeSection) {
                    if (this.data.currentUser && this.admins.includes(this.data.currentUser.email)) {
                        postTypeSection.classList.remove('hidden');
                    } else {
                        postTypeSection.classList.add('hidden');
                    }
                }
            },

            switchTab(tab) {
                this.data.currentTab = tab;
                
                const allBtn = document.getElementById('tab-all');
                const topBtn = document.getElementById('tab-top');
                const controls = document.getElementById('allNewsControls');

                if (tab === 'all') {
                    allBtn?.classList.add('bg-green-500/10', 'text-green-400', 'border-green-500/30');
                    allBtn?.classList.remove('bg-gray-900', 'text-gray-400', 'border-gray-700');
                    
                    topBtn?.classList.remove('bg-pink-500/10', 'text-pink-400', 'border-pink-500/30');
                    topBtn?.classList.add('bg-gray-900', 'text-gray-400', 'border-gray-700');
                    
                    controls?.classList.remove('hidden');
                } else {
                    topBtn?.classList.add('bg-pink-500/10', 'text-pink-400', 'border-pink-500/30');
                    topBtn?.classList.remove('bg-gray-900', 'text-gray-400', 'border-gray-700');
                    
                    allBtn?.classList.remove('bg-green-500/10', 'text-green-400', 'border-green-500/30');
                    allBtn?.classList.add('bg-gray-900', 'text-gray-400', 'border-gray-700');
                    
                    controls?.classList.add('hidden');
                }
                this.renderPosts();
            },

            setCategory(cat) {
                this.data.currentCategory = cat;
                
                document.querySelectorAll('.category-pill').forEach(btn => {
                    const btnText = btn.innerText.replace(/[^\w\s]/g, '').trim();
                    if ((cat === 'All' && btnText === 'All') || btnText === cat) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                this.renderPosts();
            },

            filterPosts() {
                const searchInput = document.getElementById('searchInput');
                this.data.searchQuery = searchInput ? searchInput.value.toLowerCase() : '';
                this.renderPosts();
            },

            toggleComments(postId) {
                if (this.data.expandedComments.has(postId)) {
                    this.data.expandedComments.delete(postId);
                } else {
                    this.data.expandedComments.add(postId);
                }
                this.renderPosts();
            },

            formatCommentText(text) {
                return text.replace(/@(\w+)/g, '<span class="text-blue-400 font-bold hover:underline cursor-pointer">@$1</span>');
            },

            // ==========================================
            // POSTS RENDERING
            // ==========================================
            
            renderPosts() {
                const container = document.getElementById('postsContainer');
                if (!container) return;
                
                container.innerHTML = '';

                let filtered = [...this.data.posts];

                if (this.data.currentTab === 'top') {
                    filtered = filtered.filter(p => p.type === 'top');
                }

                if (this.data.currentTab === 'all' && this.data.currentCategory !== 'All') {
                    filtered = filtered.filter(p => p.category === this.data.currentCategory);
                }

                if (this.data.searchQuery) {
                    filtered = filtered.filter(p => 
                        p.title?.toLowerCase().includes(this.data.searchQuery) || 
                        p.content?.toLowerCase().includes(this.data.searchQuery)
                    );
                }

                if (filtered.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-gray-500 mb-4">No posts found</div>
                            ${this.data.currentUser ? `
                            <button onclick="window.app.navigate('create')" class="bg-green-600 text-black px-6 py-2 rounded-lg font-bold hover:bg-green-500 transition-colors">
                                Create First Post
                            </button>` : '<p class="text-sm text-gray-600">Login to create posts</p>'}
                        </div>
                    `;
                    return;
                }

                filtered.forEach(post => {
                    const isAdmin = this.admins.includes(post.author);
                    const isAuthor = this.data.currentUser && this.data.currentUser.email === post.author;
                    const canDelete = isAdmin || isAuthor;
                    
                    let userLikeStatus = 'none';
                    if (this.data.currentUser) {
                        if (post.likesList?.includes(this.data.currentUser.email)) userLikeStatus = 'like';
                        if (post.dislikesList?.includes(this.data.currentUser.email)) userLikeStatus = 'dislike';
                    }

                    const card = document.createElement('div');
                    card.className = 'glass-panel rounded-xl overflow-hidden border border-gray-800 hover:border-green-500/50 transition-all duration-300 flex flex-col';
                    
                    const allComments = post.comments || [];
                    const isExpanded = this.data.expandedComments.has(post.id);
                    const displayedComments = isExpanded ? allComments : allComments.slice(0, 3);
                    const hasMoreComments = allComments.length > 3;
                    
                    let commentsHtml = '';
                    if (allComments.length > 0) {
                        const commentsList = displayedComments.map(c => `
                            <div class="text-xs text-gray-400 mb-1">
                                <span class="text-green-400 font-bold cursor-pointer hover:underline" 
                                      onclick="window.app.navigate('profile', '${this.getUserEmailByTag(c.user)}')">@${c.user}</span>: 
                                <span>${this.formatCommentText(c.text)}</span>
                            </div>
                        `).join('');
                        
                        const readMoreBtn = hasMoreComments ? `
                            <button onclick="window.app.toggleComments('${post.id}')" class="text-xs text-blue-400 hover:text-blue-300 mb-2 font-medium">
                                ${isExpanded ? 'Read Less ↑' : `Read More (${allComments.length - 3} more) ↓`}
                            </button>
                        ` : '';
                        
                        commentsHtml = `<div class="mt-3 pt-3 border-t border-gray-700 space-y-1">
                            ${readMoreBtn}
                            ${commentsList}
                        </div>`;
                    }
                    
                    card.innerHTML = `
                        ${post.image ? `
                        <div class="h-48 overflow-hidden relative group">
                            <img src="${post.image}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" 
                                 onerror="this.src='https://via.placeholder.com/800x400?text=Meme+Media'">
                            <div class="absolute top-2 right-2 bg-black/70 backdrop-blur px-2 py-1 rounded text-xs font-bold text-green-400 border border-green-500/30">
                                ${post.category}
                            </div>
                            ${post.type === 'top' ? `<div class="absolute top-2 left-2 bg-pink-600 text-white px-2 py-1 rounded text-xs font-bold shadow-lg shadow-pink-500/20"><i class="fa-solid fa-crown"></i> TOP</div>` : ''}
                        </div>` : ''}
                        
                        <div class="p-5 flex-grow flex flex-col">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-xl font-bold text-white leading-tight hover:text-green-400 cursor-pointer" 
                                    onclick="window.app.navigate('profile', '${post.author}')">${post.title}</h3>
                            </div>
                            
                            <div class="flex items-center gap-2 mb-3 text-xs text-gray-400">
                                <span class="text-green-400 font-mono cursor-pointer hover:underline" 
                                      onclick="window.app.navigate('profile', '${post.author}')">@${post.authorTag}</span>
                                <span>•</span>
                                <span>${new Date(post.timestamp).toLocaleDateString()}</span>
                            </div>

                            <p class="text-gray-300 text-sm mb-4 line-clamp-3 flex-grow">${post.content}</p>
                            
                            <div class="flex items-center justify-between pt-4 border-t border-gray-800 mt-auto">
                                <div class="flex gap-4">
                                    <button onclick="window.app.handleVote('${post.id}', 'like')" 
                                            class="flex items-center gap-1 text-sm ${userLikeStatus === 'like' ? 'text-green-400' : 'text-gray-500 hover:text-green-400'} transition-colors">
                                        <i class="fa-solid fa-arrow-up"></i> ${post.likes || 0}
                                    </button>
                                    <button onclick="window.app.handleVote('${post.id}', 'dislike')" 
                                            class="flex items-center gap-1 text-sm ${userLikeStatus === 'dislike' ? 'text-red-400' : 'text-gray-500 hover:text-red-400'} transition-colors">
                                        <i class="fa-solid fa-arrow-down"></i> ${post.dislikes || 0}
                                    </button>
                                    <button onclick="window.app.showCommentModal('${post.id}')" 
                                            class="flex items-center gap-1 text-sm text-gray-500 hover:text-blue-400 transition-colors">
                                        <i class="fa-solid fa-comment"></i> ${post.comments?.length || 0}
                                    </button>
                                </div>
                                ${canDelete ? `
                                <button onclick="window.app.deletePost('${post.id}')" class="text-gray-600 hover:text-red-500 transition-colors text-xs">
                                    <i class="fa-solid fa-trash"></i> Delete
                                </button>` : ''}
                            </div>
                            ${commentsHtml}
                        </div>
                    `;
                    container.appendChild(card);
                });
            },

            getUserEmailByTag(tag) {
                const user = this.data.users.find(u => u.tag === tag);
                return user ? user.email : '';
            },

            // ==========================================
            // POST ACTIONS
            // ==========================================
            
            async handleNewPostClick() {
                if (!this.data.currentUser) {
                    this.showToast('Please login to create a post', 'error');
                    this.toggleAuthModal();
                    return;
                }
                
                const userDoc = await db.collection('users').doc(this.data.currentUser.email).get();
                const userData = userDoc.data();
                const today = new Date().toDateString();
                
                if (!this.admins.includes(this.data.currentUser.email)) {
                    if (userData.lastPostDate === today && userData.postsToday >= 3) {
                        this.showToast('Daily post limit reached (3/3)', 'error');
                        return;
                    }
                }

                this.navigate('create');
            },

            async submitPost(e) {
                e.preventDefault();
                const form = e.target;
                
                if (!this.data.currentUser) {
                    this.showToast('Please login first', 'error');
                    return;
                }

                const title = form.title.value.trim();
                const content = form.content.value.trim();
                const category = form.category.value;
                const image = form.image.value.trim();
                
                if (!title || !content) {
                    this.showToast('Title and content are required', 'error');
                    return;
                }

                try {
                    const postData = {
                        title,
                        content,
                        category,
                        image: image || null,
                        author: this.data.currentUser.email,
                        authorTag: this.data.currentUser.tag || this.data.currentUser.email.split('@')[0],
                        timestamp: Date.now(),
                        likes: 0,
                        dislikes: 0,
                        likesList: [],
                        dislikesList: [],
                        comments: [],
                        type: (this.admins.includes(this.data.currentUser.email) && form.postType?.value === 'top') ? 'top' : 'normal'
                    };

                    await db.collection('posts').add(postData);
                    
                    // Update user post count
                    const today = new Date().toDateString();
                    const userRef = db.collection('users').doc(this.data.currentUser.email);
                    const userDoc = await userRef.get();
                    const userData = userDoc.data();
                    
                    if (userData.lastPostDate === today) {
                        await userRef.update({
                            postsToday: (userData.postsToday || 0) + 1
                        });
                    } else {
                        await userRef.update({
                            lastPostDate: today,
                            postsToday: 1
                        });
                    }

                    this.showToast('Post created successfully!', 'success');
                    this.navigate('home');
                    form.reset();
                } catch (error) {
                    console.error('Error creating post:', error);
                    this.showToast('Error creating post', 'error');
                }
            },

            async handleVote(postId, type) {
                if (!this.data.currentUser) {
                    this.showToast('Please login to vote', 'error');
                    return;
                }

                const postRef = db.collection('posts').doc(postId);
                const postDoc = await postRef.get();
                const postData = postDoc.data();

                const userEmail = this.data.currentUser.email;
                const likesList = postData.likesList || [];
                const dislikesList = postData.dislikesList || [];

                let update = {};

                if (type === 'like') {
                    if (likesList.includes(userEmail)) {
                        // Remove like
                        update = {
                            likes: (postData.likes || 0) - 1,
                            likesList: likesList.filter(email => email !== userEmail)
                        };
                    } else {
                        // Add like, remove dislike if exists
                        update = {
                            likes: (postData.likes || 0) + 1,
                            likesList: [...likesList, userEmail],
                            dislikes: dislikesList.includes(userEmail) ? (postData.dislikes || 0) - 1 : postData.dislikes || 0,
                            dislikesList: dislikesList.filter(email => email !== userEmail)
                        };
                    }
                } else {
                    if (dislikesList.includes(userEmail)) {
                        // Remove dislike
                        update = {
                            dislikes: (postData.dislikes || 0) - 1,
                            dislikesList: dislikesList.filter(email => email !== userEmail)
                        };
                    } else {
                        // Add dislike, remove like if exists
                        update = {
                            dislikes: (postData.dislikes || 0) + 1,
                            dislikesList: [...dislikesList, userEmail],
                            likes: likesList.includes(userEmail) ? (postData.likes || 0) - 1 : postData.likes || 0,
                            likesList: likesList.filter(email => email !== userEmail)
                        };
                    }
                }

                await postRef.update(update);
            },

            async deletePost(postId) {
                if (!confirm('Are you sure you want to delete this post?')) return;
                
                try {
                    await db.collection('posts').doc(postId).delete();
                    this.showToast('Post deleted', 'success');
                } catch (error) {
                    console.error('Error deleting post:', error);
                    this.showToast('Error deleting post', 'error');
                }
            },

            async addComment(postId, text) {
                if (!this.data.currentUser) {
                    this.showToast('Please login to comment', 'error');
                    return;
                }

                if (!text.trim()) {
                    this.showToast('Comment cannot be empty', 'error');
                    return;
                }

                const postRef = db.collection('posts').doc(postId);
                const comment = {
                    user: this.data.currentUser.tag || this.data.currentUser.email.split('@')[0],
                    text: text.trim(),
                    timestamp: Date.now()
                };

                await postRef.update({
                    comments: firebase.firestore.FieldValue.arrayUnion(comment)
                });
            },

            showCommentModal(postId) {
                const text = prompt('Enter your comment:');
                if (text) {
                    this.addComment(postId, text);
                }
            },

            // ==========================================
            // AUTH UI
            // ==========================================
            
            toggleAuthModal() {
                const modal = document.getElementById('authModal');
                if (modal) {
                    modal.classList.toggle('hidden');
                }
            },

            switchAuthMode(mode) {
                this.data.authMode = mode;
                const loginForm = document.getElementById('loginForm');
                const signupForm = document.getElementById('signupForm');
                
                if (mode === 'login') {
                    loginForm?.classList.remove('hidden');
                    signupForm?.classList.add('hidden');
                } else {
                    loginForm?.classList.add('hidden');
                    signupForm?.classList.remove('hidden');
                }
            },

            async handleLogin(e) {
                e.preventDefault();
                const email = e.target.email.value;
                const password = e.target.password.value;

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    this.toggleAuthModal();
                    this.showToast('Logged in successfully!', 'success');
                } catch (error) {
                    console.error('Login error:', error);
                    this.showToast(error.message, 'error');
                }
            },

            async handleSignup(e) {
                e.preventDefault();
                const email = e.target.email.value;
                const password = e.target.password.value;
                const tag = e.target.tag.value;

                if (!tag || tag.length < 3) {
                    this.showToast('Username must be at least 3 characters', 'error');
                    return;
                }

                try {
                    // Check if tag is taken
                    const tagQuery = await db.collection('users').where('tag', '==', tag).get();
                    if (!tagQuery.empty) {
                        this.showToast('Username already taken', 'error');
                        return;
                    }

                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    await db.collection('users').doc(email).set({
                        tag: tag,
                        followers: [],
                        following: [],
                        createdAt: Date.now(),
                        lastPostDate: null,
                        postsToday: 0
                    });

                    this.toggleAuthModal();
                    this.showToast('Account created!', 'success');
                } catch (error) {
                    console.error('Signup error:', error);
                    this.showToast(error.message, 'error');
                }
            },

            async handleLogout() {
                await auth.signOut();
                this.showToast('Logged out', 'success');
            },

            updateAuthUI() {
                const authBtn = document.getElementById('authBtn');
                const userInfo = document.getElementById('userInfo');
                const createPostBtn = document.getElementById('createPostBtn');

                if (this.data.currentUser) {
                    if (authBtn) authBtn.innerHTML = '<i class="fa-solid fa-sign-out-alt"></i> Logout';
                    if (authBtn) authBtn.onclick = () => this.handleLogout();
                    if (userInfo) userInfo.textContent = `@${this.data.currentUser.tag || this.data.currentUser.email.split('@')[0]}`;
                    if (createPostBtn) createPostBtn.classList.remove('hidden');
                } else {
                    if (authBtn) authBtn.innerHTML = '<i class="fa-solid fa-sign-in-alt"></i> Login';
                    if (authBtn) authBtn.onclick = () => this.toggleAuthModal();
                    if (userInfo) userInfo.textContent = '';
                    if (createPostBtn) createPostBtn.classList.add('hidden');
                }
            },

            // ==========================================
            // PROFILE
            // ==========================================
            
            async renderProfile(email) {
                if (!email) email = this.data.currentUser?.email;
                if (!email) return;

                this.data.profileViewUser = email;
                const userDoc = await db.collection('users').doc(email).get();
                const userData = userDoc.data();
                
                if (!userData) return;

                const profileName = document.getElementById('profileName');
                const profileTag = document.getElementById('profileTag');
                const profileFollowers = document.getElementById('profileFollowers');
                const profileFollowing = document.getElementById('profileFollowing');
                const followBtn = document.getElementById('followBtn');

                if (profileName) profileName.textContent = userData.tag;
                if (profileTag) profileTag.textContent = `@${userData.tag}`;
                if (profileFollowers) profileFollowers.textContent = (userData.followers || []).length;
                if (profileFollowing) profileFollowing.textContent = (userData.following || []).length;

                if (followBtn) {
                    if (email === this.data.currentUser?.email) {
                        followBtn.classList.add('hidden');
                    } else {
                        followBtn.classList.remove('hidden');
                        const isFollowing = userData.followers?.includes(this.data.currentUser?.email);
                        followBtn.textContent = isFollowing ? 'Unfollow' : 'Follow';
                        followBtn.onclick = () => this.toggleFollow(email);
                    }
                }

                // Show user's posts
                const userPosts = this.data.posts.filter(p => p.author === email);
                const profilePosts = document.getElementById('profilePosts');
                if (profilePosts) {
                    profilePosts.innerHTML = userPosts.map(post => `
                        <div class="glass-panel p-4 rounded-lg mb-4">
                            <h4 class="font-bold text-white">${post.title}</h4>
                            <p class="text-gray-400 text-sm">${new Date(post.timestamp).toLocaleDateString()}</p>
                        </div>
                    `).join('');
                }
            },

            async toggleFollow(email) {
                if (!this.data.currentUser) {
                    this.showToast('Please login to follow', 'error');
                    return;
                }

                const currentUserRef = db.collection('users').doc(this.data.currentUser.email);
                const targetUserRef = db.collection('users').doc(email);

                const currentUserDoc = await currentUserRef.get();
                const targetUserDoc = await targetUserRef.get();

                const currentFollowing = currentUserDoc.data().following || [];
                const targetFollowers = targetUserDoc.data().followers || [];

                if (currentFollowing.includes(email)) {
                    // Unfollow
                    await currentUserRef.update({
                        following: currentFollowing.filter(e => e !== email)
                    });
                    await targetUserRef.update({
                        followers: targetFollowers.filter(e => e !== this.data.currentUser.email)
                    });
                    this.showToast('Unfollowed', 'success');
                } else {
                    // Follow
                    await currentUserRef.update({
                        following: [...currentFollowing, email]
                    });
                    await targetUserRef.update({
                        followers: [...targetFollowers, this.data.currentUser.email]
                    });
                    this.showToast('Following!', 'success');
                }
            },

            renderFollowersList(type) {
                // Implementation for followers/following list
            },

            // ==========================================
            // UTILITY
            // ==========================================
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500'
                };
                
                toast.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-300`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },

            setupEventListeners() {
                // Tab switching
                document.getElementById('tab-all')?.addEventListener('click', () => this.switchTab('all'));
                document.getElementById('tab-top')?.addEventListener('click', () => this.switchTab('top'));
                
                // Search
                document.getElementById('searchInput')?.addEventListener('input', () => this.filterPosts());
                
                // Create post form
                document.getElementById('createPostForm')?.addEventListener('submit', (e) => this.submitPost(e));
                
                // Auth forms
                document.getElementById('loginForm')?.addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('signupForm')?.addEventListener('submit', (e) => this.handleSignup(e));
            },

            render() {
                this.renderPosts();
                this.updateAuthUI();
            }
        };

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.app.init();
        });
    </script>
    
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0a0a0a;
            color: #ffffff;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .category-pill.active {
            background-color: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.5);
            color: #4ade80;
        }
    </style>
</head>
<body class="min-h-screen bg-black text-white">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-black/80 backdrop-blur-md border-b border-gray-800 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-bold text-green-400 cursor-pointer" onclick="window.app.navigate('home')">MEME MEDIA</h1>
                </div>
                <div class="flex items-center gap-4">
                    <span id="userInfo" class="text-green-400 text-sm"></span>
                    <button id="authBtn" class="text-gray-300 hover:text-white transition-colors">
                        <i class="fa-solid fa-sign-in-alt"></i> Login
                    </button>
                    <button id="createPostBtn" class="hidden bg-green-600 text-black px-4 py-2 rounded-lg font-bold hover:bg-green-500 transition-colors" onclick="window.app.handleNewPostClick()">
                        <i class="fa-solid fa-plus"></i> New Post
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Auth Modal -->
    <div id="authModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="glass-panel p-8 rounded-2xl max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Authentication</h2>
                <button onclick="window.app.toggleAuthModal()" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <input type="email" name="email" placeholder="Email" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                <input type="password" name="password" placeholder="Password" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                <button type="submit" class="w-full bg-green-600 text-black font-bold py-3 rounded-lg hover:bg-green-500 transition-colors">Login</button>
                <p class="text-center text-gray-400 text-sm">
                    Don't have an account? 
                    <button type="button" onclick="window.app.switchAuthMode('signup')" class="text-green-400 hover:underline">Sign up</button>
                </p>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="hidden space-y-4">
                <input type="text" name="tag" placeholder="Username" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                <input type="email" name="email" placeholder="Email" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                <input type="password" name="password" placeholder="Password" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                <button type="submit" class="w-full bg-green-600 text-black font-bold py-3 rounded-lg hover:bg-green-500 transition-colors">Sign Up</button>
                <p class="text-center text-gray-400 text-sm">
                    Already have an account? 
                    <button type="button" onclick="window.app.switchAuthMode('login')" class="text-green-400 hover:underline">Login</button>
                </p>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-20 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Home View -->
        <div id="homeView" class="space-y-6">
            <!-- Tabs -->
            <div class="flex gap-4 mb-6">
                <button id="tab-all" class="px-6 py-2 rounded-lg font-bold border transition-all bg-green-500/10 text-green-400 border-green-500/30">
                    All News
                </button>
                <button id="tab-top" class="px-6 py-2 rounded-lg font-bold border transition-all bg-gray-900 text-gray-400 border-gray-700">
                    Top News
                </button>
            </div>

            <!-- Controls -->
            <div id="allNewsControls" class="flex flex-col sm:flex-row gap-4 mb-6">
                <input type="text" id="searchInput" placeholder="Search posts..." class="flex-1 bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-green-500 focus:outline-none">
                <div class="flex gap-2 flex-wrap">
                    <button class="category-pill active px-4 py-2 rounded-full border border-gray-700 text-sm hover:border-green-500/50 transition-all" onclick="window.app.setCategory('All')">All</button>
                    <button class="category-pill px-4 py-2 rounded-full border border-gray-700 text-sm hover:border-green-500/50 transition-all" onclick="window.app.setCategory('Crypto')">Crypto</button>
                    <button class="category-pill px-4 py-2 rounded-full border border-gray-700 text-sm hover:border-green-500/50 transition-all" onclick="window.app.setCategory('Memes')">Memes</button>
                    <button class="category-pill px-4 py-2 rounded-full border border-gray-700 text-sm hover:border-green-500/50 transition-all" onclick="window.app.setCategory('Finance')">Finance</button>
                </div>
            </div>

            <!-- Posts Grid -->
            <div id="postsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Posts will be rendered here -->
            </div>
        </div>

        <!-- Create Post View -->
        <div id="createPostView" class="hidden max-w-2xl mx-auto">
            <div class="glass-panel p-8 rounded-2xl">
                <h2 class="text-2xl font-bold mb-6">Create New Post</h2>
                <form id="createPostForm" class="space-y-4">
                    <div id="postTypeSection" class="hidden">
                        <select name="postType" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                            <option value="normal">Normal Post</option>
                            <option value="top">Top News</option>
                        </select>
                    </div>
                    <input type="text" name="title" placeholder="Post Title" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                    <textarea name="content" placeholder="Post Content" required rows="6" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none"></textarea>
                    <select name="category" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                        <option value="General">General</option>
                        <option value="Crypto">Crypto</option>
                        <option value="Memes">Memes</option>
                        <option value="Finance">Finance</option>
                    </select>
                    <input type="url" name="image" placeholder="Image URL (optional)" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-green-500 focus:outline-none">
                    <div class="flex gap-4">
                        <button type="button" onclick="window.app.navigate('home')" class="flex-1 bg-gray-700 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition-colors">Cancel</button>
                        <button type="submit" class="flex-1 bg-green-600 text-black font-bold py-3 rounded-lg hover:bg-green-500 transition-colors">Create Post</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profileView" class="hidden max-w-4xl mx-auto">
            <div class="glass-panel p-8 rounded-2xl mb-6">
                <div class="flex items-center gap-6 mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-3xl font-bold">
                        <span id="profileInitials">?</span>
                    </div>
                    <div>
                        <h2 id="profileName" class="text-3xl font-bold">User</h2>
                        <p id="profileTag" class="text-green-400">@user</p>
                    </div>
                    <button id="followBtn" class="ml-auto bg-green-600 text-black px-6 py-2 rounded-lg font-bold hover:bg-green-500 transition-colors">Follow</button>
                </div>
                <div class="flex gap-8 text-center">
                    <div>
                        <div id="profileFollowers" class="text-2xl font-bold">0</div>
                        <div class="text-gray-400 text-sm">Followers</div>
                    </div>
                    <div>
                        <div id="profileFollowing" class="text-2xl font-bold">0</div>
                        <div class="text-gray-400 text-sm">Following</div>
                    </div>
                </div>
            </div>
            <h3 class="text-xl font-bold mb-4">Posts</h3>
            <div id="profilePosts" class="space-y-4">
                <!-- User posts will be rendered here -->
            </div>
        </div>

    </main>

</body>
</html>
